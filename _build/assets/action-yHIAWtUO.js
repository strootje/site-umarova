import{h as E,B,C as D,i as S,G as C,g as A,s as F}from"./web-DaMsNJIW.js";import{o as I,g as M,p as _,m as j}from"./routing-CokHNnMg.js";const k="Location",K=5e3,U=18e4;let w=new Map;setInterval(()=>{const t=Date.now();for(let[e,n]of w.entries())!n[4].count&&t-n[0]>U&&w.delete(e)},3e5);function m(){return w}function X(t,e=!0){return C(()=>{const n=Date.now();L(t,o=>{e&&(o[0]=0),o[4][1](n)})})}function L(t,e){t&&!Array.isArray(t)&&(t=[t]);for(let n of w.keys())(t===void 0||$(n,t))&&e(w.get(n))}function y(t,e){t.GET&&(t=t.GET);const n=(...o)=>{const a=m(),i=M(),l=_(),O=A()?I():void 0,d=Date.now(),p=e+R(o);let r=a.get(p),g;if(B()&&!D&&(g=!0,S(()=>r[4].count--)),r&&r[0]&&(i==="native"||r[4].count||Date.now()-r[0]<K)){g&&(r[4].count++,r[4][0]()),r[3]==="preload"&&i!=="preload"&&(r[0]=d);let s=r[1];return i!=="preload"&&(s="then"in r[1]?r[1].then(f(!1),f(!0)):f(!1)(r[1]),i==="navigate"&&C(()=>r[4][1](r[0]))),l&&"then"in s&&s.catch(()=>{}),s}let c=F.context&&F.has(p)?F.load(p):t(...o);return r?(r[0]=d,r[1]=c,r[3]=i,i==="navigate"&&C(()=>r[4][1](r[0]))):(a.set(p,r=[d,c,,i,E(d)]),r[4].count=0),g&&(r[4].count++,r[4][0]()),i!=="preload"&&(c="then"in c?c.then(f(!1),f(!0)):f(!1)(c)),l&&"then"in c&&c.catch(()=>{}),c;function f(s){return async u=>{if(u instanceof Response){const b=u.headers.get(k);if(b!==null){O&&b.startsWith("/")?C(()=>{O(b,{replace:!0})}):window.location.href=b;return}u.customBody&&(u=await u.customBody())}if(s)throw u;return r[2]=u,u}}};return n.keyFor=(...o)=>e+R(o),n.key=e,n}y.get=t=>m().get(t)[2];y.set=(t,e)=>{const n=m(),o=Date.now();let a=n.get(t);a?(a[0]=o,a[1]=Promise.resolve(e),a[2]=e,a[3]="preload"):(n.set(t,a=[o,Promise.resolve(e),e,"preload",E(o)]),a[4].count=0)};y.delete=t=>m().delete(t);y.clear=()=>m().clear();function $(t,e){for(let n of e)if(n&&t.startsWith(n))return!0;return!1}function R(t){return JSON.stringify(t,(e,n)=>x(n)?Object.keys(n).sort().reduce((o,a)=>(o[a]=n[a],o),{}):n)}function x(t){let e;return t!=null&&typeof t=="object"&&(!(e=Object.getPrototypeOf(t))||e===Object.prototype)}const P=new Map;function H(t,e={}){function n(...i){const l=this.r,h=this.f,O=(l.singleFlight&&t.withOptions?t.withOptions({headers:{"X-Single-Flight":"true"}}):t)(...i),[d,p]=E();let r;function g(c){return async f=>{const s=await W(f,c,l.navigatorFactory());let u=null;if(o.onComplete?.({...r,result:s?.data,error:s?.error,pending:!1,retry(){return u=r.retry()}}),u)return u;if(!s)return r.clear();if(p(s),s.error&&!h)throw s.error;return s.data}}return l.submissions[1](c=>[...c,r={input:i,url:a,get result(){return d()?.data},get error(){return d()?.error},get pending(){return!d()},clear(){l.submissions[1](f=>f.filter(s=>s!==r))},retry(){return p(void 0),t(...i).then(g(),g(!0))}}]),O.then(g(),g(!0))}const o=typeof e=="string"?{name:e}:e,a=t.url||o.name&&`https://action/${o.name}`||`https://action/${G(t.toString())}`;return n.base=a,T(n,a)}function T(t,e){return t.toString=()=>{if(!e)throw new Error("Client Actions need explicit names if server rendered");return e},t.with=function(...n){const o=function(...i){return t.call(this,...n,...i)};o.base=t.base;const a=new URL(e,j);return a.searchParams.set("args",R(n)),T(o,(a.origin==="https://action"?a.origin:"")+a.pathname+a.search)},t.url=e,P.set(e,t),A()&&S(()=>P.delete(e)),t}const G=t=>t.split("").reduce((e,n)=>(e<<5)-e+n.charCodeAt(0)|0,0);async function W(t,e,n){let o,a,i,l;if(t instanceof Response){if(t.headers.has("X-Revalidate")&&(i=t.headers.get("X-Revalidate").split(",")),t.customBody&&(o=a=await t.customBody(),t.headers.has("X-Single-Flight")&&(o=o._$value,delete a._$value,l=Object.keys(a))),t.headers.has("Location")){const h=t.headers.get("Location")||"/";h.startsWith("http")?window.location.href=h:n(h)}}else{if(e)return{error:t};o=t}return L(i,h=>h[0]=0),l&&l.forEach(h=>y.set(h,a[h])),await X(i,!1),o!=null?{data:o}:void 0}export{P as a,H as b,y as q};
